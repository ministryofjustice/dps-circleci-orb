description: "Install tools and configure kubectl"
steps:
  - aws-cli/install
  - kubernetes/install
  - helm/install-helm-client:
      version: v3.0.2
  - run:
      name: Setup kubectl
      command: |
        echo -n "${KUBE_ENV_CACERT}" | base64 -d > /tmp/cluster_ca.crt
        kubectl config set-cluster "${KUBE_ENV_NAME}" \
          --certificate-authority="/tmp/cluster_ca.crt" \
          --server="${KUBE_ENV_API}"
        kubectl config set-credentials circleci \
          --token="${KUBE_ENV_TOKEN}"
        kubectl config set-context circleci \
          --cluster="${KUBE_ENV_NAME}" \
          --user="circleci" \
          --namespace="${KUBE_ENV_NAMESPACE}"
        kubectl config use-context circleci
